<!DOCTYPE html>
<html>
<head>
    <title>Backend Connectivity Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #22c55e; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; margin: 10px 0; }
        pre { background: #2a2a2a; padding: 15px; border-radius: 5px; overflow: auto; }
        .error { color: #ef4444; }
        .success { color: #22c55e; }
        .info { color: #fcd34d; }
    </style>
</head>
<body>
    <h1>üîç Backend Connectivity Diagnostic Tool</h1>
    
    <button onclick="testBackend()">Test Backend Connection</button>
    <button onclick="testCORS()">Test CORS</button>
    <button onclick="testDirect()">Test Direct (no CORS)</button>
    
    <div id="results"></div>

    <script>
        const BACKEND_URL = 'https://web-production-2f56.up.railway.app';
        
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            results.innerHTML += `<div class="${type}">[${timestamp}] ${message}</div>`;
        }
        
        async function testBackend() {
            document.getElementById('results').innerHTML = '';
            log('Testing backend at: ' + BACKEND_URL, 'info');
            
            try {
                log('Attempting fetch...', 'info');
                const response = await fetch(`${BACKEND_URL}/api/health`);
                log(`Response status: ${response.status}`, response.ok ? 'success' : 'error');
                
                const data = await response.json();
                log('Backend is ONLINE! ‚úÖ', 'success');
                log('Response data:', 'info');
                log(JSON.stringify(data, null, 2), 'success');
                
                if (data.cors_fixed) {
                    log('CORS fix is deployed! ‚úÖ', 'success');
                } else {
                    log('CORS fix not yet deployed ‚ö†Ô∏è', 'error');
                }
            } catch (error) {
                log('Backend connection FAILED! ‚ùå', 'error');
                log('Error: ' + error.message, 'error');
                log('Error details: ' + JSON.stringify(error), 'error');
                
                if (error.message.includes('CORS')) {
                    log('This is a CORS error - backend is running but CORS is blocking', 'error');
                } else if (error.message.includes('Failed to fetch')) {
                    log('Network error - backend might be offline or URL is wrong', 'error');
                }
            }
        }
        
        async function testCORS() {
            document.getElementById('results').innerHTML = '';
            log('Testing CORS preflight...', 'info');
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/health`, {
                    method: 'OPTIONS',
                    headers: {
                        'Origin': window.location.origin,
                        'Access-Control-Request-Method': 'GET',
                    }
                });
                
                log(`OPTIONS request status: ${response.status}`, response.ok ? 'success' : 'error');
                log('CORS headers:', 'info');
                for (const [key, value] of response.headers) {
                    if (key.toLowerCase().includes('access-control')) {
                        log(`  ${key}: ${value}`, 'success');
                    }
                }
            } catch (error) {
                log('CORS preflight FAILED! ‚ùå', 'error');
                log('Error: ' + error.message, 'error');
            }
        }
        
        function testDirect() {
            document.getElementById('results').innerHTML = '';
            log('Opening backend URL in new tab...', 'info');
            log('Check if it loads JSON successfully', 'info');
            window.open(`${BACKEND_URL}/api/health`, '_blank');
        }
    </script>
</body>
</html>
